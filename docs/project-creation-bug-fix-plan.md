# 新規プロジェクト作成機能のバグ修正計画

## 概要

新規小説プロジェクト作成機能において、「著者名を入力しただけでdialogoi.yamlが勝手に作成される」問題が発生している。これにより、既存ファイルのルックアップ機能が正常に動作しない。

## 発見された問題

### 1. 自動保存による意図しないプロジェクト作成
- **場所**: `webview/components/ProjectSettingsApp/ProjectSettingsApp.tsx`
- **問題**: フィールドのonBlur時に自動的に`autoSave()`が呼ばれる
- **影響**: 著者名入力後のフォーカスアウトでdialogoi.yamlが即座に作成される

### 2. 既存ファイル自動取り込み機能の仕様問題
- **場所**: `src/services/ProjectCreationService.ts`
- **問題**: 複雑すぎて理解しにくく、ユーザビリティが低い
- **要望**: 手動でファイルを追加する方式に変更したい

## 修正フェーズ

### Phase 1: 緊急バグ修正 ✅ **完了・テスト済み**
- [x] 新規プロジェクト時の自動保存を無効化
- [x] 「プロジェクトを作成」ボタン押下時のみ作成実行
- [x] ボタンのバリデーション強化
- [x] テストケースの修正
- [x] 動作確認完了

**実装済み変更点:**
- `handleFieldBlur()`: 新規プロジェクト時は自動保存しない
- `handleAddTag()`, `handleRemoveTag()`: 新規プロジェクト時は自動保存しない
- 作成ボタンのdisabled状態制御とエラーメッセージ表示
- テストケース更新：必須フィールドのバリデーションテスト

**検証結果:**
- ✅ 新規プロジェクト時に著者名入力だけではdialogoi.yamlが作成されない
- ✅ 「プロジェクトを作成」ボタンを押した時のみ作成される
- ✅ 必須フィールドが空の場合はボタンがdisabledになる
- ✅ バリデーションエラーメッセージが正しく表示される
- ✅ 既存プロジェクトの自動保存は引き続き動作する（新規プロジェクト時のみ無効化）

### Phase 2: セマンティックバージョニング削除 ✅ **完了**
- [x] DialogoiYamlインターフェースからversionフィールドを削除
- [x] バリデーションロジックからversion関連のチェックを削除
- [x] 全てのサービス・コンポーネントからversion参照を削除
- [x] テストファイルの更新
- [x] テンプレートファイルからversionを削除

**実装内容:**
- `updated_at`タイムスタンプのみでバージョン管理
- セマンティックバージョニングは小説執筆に不適切と判断

### Phase 3: プロジェクト作成後の自動クローズ ✅ **完了**
- [x] 作成成功時にパネルを自動的に閉じる機能を追加
- [x] WebViewからExtensionへの`closePanel`メッセージ送信
- [x] ProjectSettingsWebviewPanelでの処理実装

### Phase 4: デフォルト値設定 ✅ **完了**
- [x] README ファイル名: デフォルトで `README.md` を設定
- [x] 除外パターン: よくある除外対象ファイルをデフォルトで設定
  - 隠しファイル（`.*`）
  - OSシステムファイル（`.DS_Store`, `Thumbs.db`, `desktop.ini`等）
  - VCS関連（`.git`, `.svn`, `.hg`等）
  - 一時ファイル（`*.tmp`, `*.temp`, `*.log`等）
  - 開発関連（`node_modules`, `dist`, `build`）

## 今後の課題

### Phase 5: 既存ファイル自動取り込み機能の見直し
- [ ] 現在の実装の詳細調査
- [ ] 自動取り込み機能の削除可能性検討
- [ ] アントラックドファイル手動追加機能の設計

### Phase 6: 必須ファイル不存在時の対応仕様
- [ ] .dialogoi-meta.yaml不存在時の動作
- [ ] READMEファイル不存在時の動作
- [ ] エラーハンドリングの改善

### Phase 7: 不整合ファイルの扱い
- [ ] .dialogoi-meta.yamlに記載されているが存在しないファイルの処理
- [ ] ファイル削除時の自動クリーンアップ機能

## 完了した実装 (2025-01-26)

### 全体的な成果
1. ✅ 新規プロジェクト作成時の自動保存バグを修正
2. ✅ セマンティックバージョニングを削除し、よりシンプルな管理方式に移行
3. ✅ プロジェクト作成後の自動クローズでUXを改善
4. ✅ デフォルト値設定により、ユーザーの手間を削減

### テスト結果
- TypeScriptコンパイル: ✅ エラーなし
- ESLint: ✅ 警告なし
- 動作確認: ✅ 期待通りの挙動