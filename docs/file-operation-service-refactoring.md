# FileOperationService åˆ†å‰²ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨ˆç”»æ›¸

ä½œæˆæ—¥: 2025-01-28  
æœ€çµ‚æ›´æ–°: 2025-01-28

## æ¦‚è¦

FileOperationServiceã¯ç¾åœ¨1714è¡Œã€25+ãƒ¡ã‚½ãƒƒãƒ‰ã®å·¨å¤§ãªã‚¯ãƒ©ã‚¹ï¼ˆGod Objectï¼‰ã¨ãªã£ã¦ãŠã‚Šã€åˆ†å‰²ãŒå¿…è¦ã€‚
ã—ã‹ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚’å®‰æ˜“ã«åˆ†é›¢ã™ã‚‹ã¨ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ãƒªã‚¹ã‚¯ãŒç”Ÿã˜ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**é‡è¦ãªè¨­è¨ˆæ–¹é‡**: 
- ã€Œãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œå¾Œã¯å¿…ãšãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚‚æ›´æ–°ã™ã‚‹ã€ã¨ã„ã†åŸå‰‡ã‚’ä¿æŒ
- ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã—å¿˜ã‚Œã®ãƒŸã‚¹ã‚’é˜²ãè¨­è¨ˆã‚’å„ªå…ˆ
- ãã®ä¸Šã§ã€æ©Ÿèƒ½åˆ¥ã®åˆ†å‰²ã«ã‚ˆã‚Šä¿å®ˆæ€§ã‚’å‘ä¸Š

## èª¿æŸ»é …ç›®

### Phase 1: åˆ©ç”¨çŠ¶æ³èª¿æŸ» ğŸ”„ **é€²è¡Œä¸­**

#### 1.1 FileOperationServiceã®åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³èª¿æŸ»
- [ ] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã‚’ä¼´ã‚ãªã„ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®å­˜åœ¨ç¢ºèª
- [ ] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’æ›´æ–°ã—ãŸã„æ“ä½œã®å­˜åœ¨ç¢ºèª  
- [ ] å„ãƒ¡ã‚½ãƒƒãƒ‰ã®åˆ©ç”¨ç®‡æ‰€ã¨ç”¨é€”ã®è©³ç´°åˆ†æ

#### 1.2 FileManagementServiceã¨ã®é–¢ä¿‚èª¿æŸ»
- [ ] FileManagementServiceã®åˆ©ç”¨çŠ¶æ³
- [ ] FileOperationServiceã¨ã®æ©Ÿèƒ½é‡è¤‡ã®è©³ç´°ç¢ºèª
- [ ] çµ±åˆã®å¿…è¦æ€§ã¨å½±éŸ¿ç¯„å›²ã®è©•ä¾¡

#### 1.3 ãƒ¡ã‚½ãƒƒãƒ‰åˆ†é¡
- [ ] ç¾åœ¨ã®25+ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ©Ÿèƒ½åˆ¥ã«åˆ†é¡
- [ ] å„ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—ä½œæˆ
- [ ] åˆ†å‰²å€™è£œã®ç‰¹å®š

### Phase 2: åˆ†å‰²è¨­è¨ˆ
- [ ] ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ä¿ã¤åˆ†å‰²æ–¹æ³•ã®è¨­è¨ˆ
- [ ] æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹æ§‹é€ ã®ææ¡ˆ
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨­è¨ˆ

### Phase 3: å®Ÿè£…
- [ ] æ®µéšçš„ãªåˆ†å‰²å®Ÿè£…
- [ ] ãƒ†ã‚¹ãƒˆæ›´æ–°
- [ ] åˆ©ç”¨ç®‡æ‰€ã®æ›´æ–°

## èª¿æŸ»çµæœ

### FileOperationServiceã®ç¾çŠ¶åˆ†æ

**åŸºæœ¬æƒ…å ±:**
- ãƒ•ã‚¡ã‚¤ãƒ«è¡Œæ•°: 1714è¡Œ
- ãƒ¡ã‚½ãƒƒãƒ‰æ•°: **30å€‹** (public: 22å€‹, private: 8å€‹)
- ä¸»è¦ä¾å­˜é–¢ä¿‚: FileRepository, MetaYamlService
- åˆ©ç”¨ç®‡æ‰€: 12ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸Š

**å•é¡Œç‚¹:**
1. **God ObjectåŒ–**: å˜ä¸€è²¬ä»»åŸå‰‡é•å
2. **ä¿å®ˆæ€§ã®ä½ä¸‹**: å·¨å¤§ã™ãã¦å¤‰æ›´å½±éŸ¿ã®æŠŠæ¡ãŒå›°é›£
3. **ãƒ†ã‚¹ãƒˆã®è¤‡é›‘åŒ–**: å·¨å¤§ã‚¯ãƒ©ã‚¹ã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆä½œæˆãƒ»ä¿å®ˆã®å›°é›£

### å…¨ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§

#### åŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰
```typescript
// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
78: async createFile(dirPath: string, fileName: string, fileType: 'content' | 'setting' | 'subdirectory', initialContent: string = '', tags: string[] = [], subtype?: 'character' | 'foreshadowing' | 'glossary'): Promise<FileOperationResult>
1519: async createFileAsync(dirPath: string, fileName: string, fileType: 'content' | 'setting' | 'subdirectory', initialContent: string = '', tags: string[] = [], subtype?: 'character' | 'foreshadowing' | 'glossary'): Promise<FileOperationResult>

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‰Šé™¤
189: async deleteFile(dirPath: string, fileName: string): Promise<FileOperationResult>
1632: async deleteFileAsync(dirPath: string, fileName: string): Promise<FileOperationResult>
923: async deleteDirectoryAsync(parentDir: string, dirName: string): Promise<FileOperationResult>
974: async deleteDirectory(parentDir: string, dirName: string): Promise<FileOperationResult>

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç§»å‹•ãƒ»ãƒªãƒãƒ¼ãƒ 
281: async renameFile(dirPath: string, oldName: string, newName: string): Promise<FileOperationResult>
375: async renameFileAsync(dirPath: string, oldName: string, newName: string): Promise<FileOperationResult>
1126: async moveFileAsync(sourceDir: string, fileName: string, targetDir: string, newIndex?: number): Promise<FileOperationResult>
1025: async moveDirectoryAsync(sourceParentDir: string, dirName: string, targetParentDir: string, newIndex?: number): Promise<FileOperationResult>

// ãƒ•ã‚¡ã‚¤ãƒ«é †åºæ“ä½œ
236: async reorderFiles(dirPath: string, fromIndex: number, toIndex: number): Promise<FileOperationResult>
```

#### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰
```typescript
// ã‚¿ã‚°æ“ä½œ
468: async addTag(dirPath: string, fileName: string, tag: string): Promise<FileOperationResult>
510: async removeTag(dirPath: string, fileName: string, tag: string): Promise<FileOperationResult>
551: async setTags(dirPath: string, fileName: string, tags: string[]): Promise<FileOperationResult>

// å‚ç…§æ“ä½œ
587: async addReference(dirPath: string, fileName: string, referencePath: string): Promise<FileOperationResult>
633: async removeReference(dirPath: string, fileName: string, referencePath: string): Promise<FileOperationResult>
678: async setReferences(dirPath: string, fileName: string, references: string[]): Promise<FileOperationResult>
```

#### æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰
```typescript
// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ“ä½œ
718: async setCharacterImportance(dirPath: string, fileName: string, importance: 'main' | 'sub' | 'background'): Promise<FileOperationResult>
764: async setMultipleCharacters(dirPath: string, fileName: string, multipleCharacters: boolean): Promise<FileOperationResult>
810: async removeCharacter(dirPath: string, fileName: string): Promise<FileOperationResult>

// ä¼ç·šæ“ä½œ  
845: async setForeshadowing(dirPath: string, fileName: string, foreshadowingData: ForeshadowingData): Promise<FileOperationResult>
887: async removeForeshadowing(dirPath: string, fileName: string): Promise<FileOperationResult>
```

#### ä½ãƒ¬ãƒ™ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œï¼ˆãƒ—ãƒ­ã‚­ã‚·ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
```typescript
1681: async readFileAsync(filePath: string, encoding: 'utf8' = 'utf8'): Promise<string>
1689: async writeFileAsync(filePath: string, content: string): Promise<void>
1697: async existsAsync(filePath: string): Promise<boolean>
```

#### ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰
```typescript
49: getNovelRootPath(): string | undefined
58: private ensureAbsolutePath(inputPath: string): string
1279: private async updateLinksForDirectoryMoveAsync(oldDirPath: string, newDirPath: string): Promise<void>
1305: private async walkDirectoryForLinkUpdateAsync(currentOldDirPath: string, currentNewDirPath: string, rootOldDirPath: string, rootNewDirPath: string): Promise<void>
1385: private async updateMetaYamlAsync(dirPath: string, updateFunction: (meta: MetaYaml) => MetaYaml): Promise<FileOperationResult>
1434: private updateHyperlinkReferences(_fileAbsolutePath: string): void
1493: updateAllReferences(_fileAbsolutePath: string, _manualReferences: string[] = []): void
1705: private async moveCommentFileIfExists(fileItem: DialogoiTreeItem, sourceDir: string, targetDir: string): Promise<void>
```

### åˆ©ç”¨çŠ¶æ³èª¿æŸ»çµæœ âœ… **å®Œäº†**

#### ä¸»è¦åˆ©ç”¨ç®‡æ‰€ã®åˆ†æ

**èª¿æŸ»å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«:**
- `DialogoiTreeDataProvider.ts` - TreeViewã®ä¸»è¦æ“ä½œ
- `FileDetailsViewProvider.ts` - WebViewè©³ç´°è¡¨ç¤º
- `characterCommands.ts` - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é–¢é€£ã‚³ãƒãƒ³ãƒ‰
- `foreshadowingCommands.ts` - ä¼ç·šé–¢é€£ã‚³ãƒãƒ³ãƒ‰ï¼ˆç¾åœ¨ç„¡åŠ¹åŒ–ï¼‰

#### å„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã®åˆ©ç”¨ãƒ¡ã‚½ãƒƒãƒ‰

**DialogoiTreeDataProvider.tsï¼ˆæœ€å¤§åˆ©ç”¨ç®‡æ‰€ï¼‰:**
- `createFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ
- `deleteFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ
- `deleteDirectoryAsync()` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå‰Šé™¤ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ
- `reorderFiles()` - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿**
- `renameFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ
- `addTag()`, `removeTag()`, `setTags()` - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿**
- `addReference()`, `removeReference()`, `setReferences()` - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿**
- `moveFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«ç§»å‹• + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ
- `moveDirectoryAsync()` - ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç§»å‹• + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ

**FileDetailsViewProvider.ts:**
- `renameFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´ + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œ

**characterCommands.ts:**
- `setCharacterImportance()` - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿**
- `setMultipleCharacters()` - **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿**

#### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æ

**ãƒ‘ã‚¿ãƒ¼ãƒ³A: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ + å¿…é ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°**
- `createFileAsync()`, `deleteFileAsync()`, `renameFileAsync()`
- `moveFileAsync()`, `moveDirectoryAsync()`, `deleteDirectoryAsync()`
- **ç‰¹å¾´**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œãŒå¿…ãšã‚»ãƒƒãƒˆ

**ãƒ‘ã‚¿ãƒ¼ãƒ³B: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®ã¿ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ä¸è¦ï¼‰**
- **è©²å½“ãªã—** - èª¿æŸ»ã—ãŸç¯„å›²ã§ã¯ç´”ç²‹ãªãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„
- `readFileAsync()`, `writeFileAsync()`, `existsAsync()`ã¯å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã§æœªä½¿ç”¨

**ãƒ‘ã‚¿ãƒ¼ãƒ³C: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã®ã¿**
- `reorderFiles()` - ãƒ•ã‚¡ã‚¤ãƒ«é †åºå¤‰æ›´
- ã‚¿ã‚°æ“ä½œ: `addTag()`, `removeTag()`, `setTags()`
- å‚ç…§æ“ä½œ: `addReference()`, `removeReference()`, `setReferences()`
- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ“ä½œ: `setCharacterImportance()`, `setMultipleCharacters()`
- **ç‰¹å¾´**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã¯è§¦ã‚Œãšã€meta.yamlã®ã¿æ›´æ–°

### FileManagementServiceã¨ã®é–¢ä¿‚èª¿æŸ» âœ… **å®Œäº†**

#### FileManagementServiceã®æ¦‚è¦
- **ãƒ¡ã‚½ãƒƒãƒ‰æ•°**: 3å€‹ (å…¨ã¦public async)
- **è²¬å‹™**: ç®¡ç†å¯¾è±¡å¤–ãƒ•ã‚¡ã‚¤ãƒ«ã®è¿½åŠ ãƒ»å‰Šé™¤ã€æ¬ æãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
- **åˆ©ç”¨ç®‡æ‰€**: `fileCommands.ts`ã§ã®ã¿ä½¿ç”¨

#### FileManagementServiceã®ãƒ¡ã‚½ãƒƒãƒ‰
```typescript
// ç®¡ç†å¯¾è±¡å¤–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’meta.yamlã«è¿½åŠ ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿æ“ä½œï¼‰
31: async addFileToManagement(absoluteFilePath: string, fileType: 'content' | 'setting'): Promise<FileManagementResult>

// meta.yamlã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤ï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿æ“ä½œï¼‰
98: async removeFileFromManagement(absoluteFilePath: string): Promise<FileManagementResult>

// æ¬ æãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰©ç†çš„ã«ä½œæˆï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã®ã¿ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãªã—ï¼‰
147: async createMissingFile(absoluteFilePath: string, template?: string): Promise<FileManagementResult>
```

#### FileOperationServiceã¨ã®æ©Ÿèƒ½æ¯”è¼ƒ

| æ©Ÿèƒ½ | FileOperationService | FileManagementService | é‡è¤‡åˆ¤å®š |
|------|---------------------|----------------------|---------|
| ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ | `createFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¿½åŠ  | `createMissingFile()` - ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã®ã¿ | **é•ã†ç›®çš„** |
| ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ | `deleteFileAsync()` - ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ | `removeFileFromManagement()` - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã®ã¿ | **é•ã†ç›®çš„** |
| ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¿½åŠ  | æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã«è‡ªå‹•å®Ÿè¡Œ | `addFileToManagement()` - æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†å¯¾è±¡ã« | **é•ã†ç›®çš„** |

#### åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã®åˆ†æ
- **FileManagementService**: ç®¡ç†å¯¾è±¡å¤–ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¾Œã‹ã‚‰ç®¡ç†ã«å«ã‚ã‚‹å ´åˆã‚„ã€æ¬ æãƒ•ã‚¡ã‚¤ãƒ«ã®è£œå®Œ
- **FileOperationService**: é€šå¸¸ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ï¼ˆä½œæˆãƒ»å‰Šé™¤ãƒ»ç§»å‹•ç­‰ï¼‰

#### çµ±åˆã®å¿…è¦æ€§è©•ä¾¡

**çµ±åˆã™ã¹ãç†ç”±:**
1. **è²¬å‹™ã®è¿‘ä¼¼æ€§**: ä¸¡æ–¹ã¨ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã«é–¢ã™ã‚‹å‡¦ç†
2. **åˆ©ç”¨ç®‡æ‰€ã®å°‘ãªã•**: FileManagementServiceã¯1ç®‡æ‰€ã§ã®ã¿ä½¿ç”¨
3. **ä¸€è²«æ€§å‘ä¸Š**: ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†æ©Ÿèƒ½ã®çµ±ä¸€åŒ–

**çµ±åˆæ™‚ã®æ³¨æ„ç‚¹:**
- `createMissingFile()`ã¯ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã®ã¿ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ãªã—
- ã“ã®ç‰¹æ®ŠãªæŒ™å‹•ã‚’ç¶­æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### ğŸ” **é‡è¦ãªç™ºè¦‹**

1. **ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯å¸¸ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨ã‚»ãƒƒãƒˆ**: ç‰©ç†ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã‚’è¡Œã†ãƒ¡ã‚½ãƒƒãƒ‰ã¯100%ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚‚æ›´æ–°
2. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å°‚ç”¨æ“ä½œãŒå¤šæ•°å­˜åœ¨**: ã‚¿ã‚°ãƒ»å‚ç…§ãƒ»ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»é †åºå¤‰æ›´ãªã©
3. **ç´”ç²‹ãªãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„**: ä½ãƒ¬ãƒ™ãƒ«APIã¯å¤–éƒ¨ã‹ã‚‰ç›´æ¥åˆ©ç”¨ã•ã‚Œã¦ã„ãªã„
4. **æ•´åˆæ€§ãŒä¿ãŸã‚Œã¦ã„ã‚‹**: ç¾åœ¨ã®è¨­è¨ˆã§ã¯ã€Œãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã—å¿˜ã‚Œã€ã¯æ§‹é€ çš„ã«ç™ºç”Ÿã—ãªã„
5. **FileManagementServiceã¯ç‰¹æ®Šç”¨é€”**: é€šå¸¸ã¨ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æä¾›

### èª¿æŸ»çµè«–ã¨åˆ†å‰²æˆ¦ç•¥ âœ… **å®Œäº†**

#### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã«ã¤ã„ã¦ã®çµè«–

**èª¿æŸ»çµæœï¼šåˆ†é›¢ãƒªã‚¹ã‚¯ã¯ä½ã„**
- ç¾åœ¨ã®åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã€ã‹ã€Œãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ã¿æ“ä½œã€ã®2ç¨®é¡ã®ã¿
- ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿æ“ä½œã€ã¯å­˜åœ¨ã—ãªã„ï¼ˆä½ãƒ¬ãƒ™ãƒ«APIã¯å†…éƒ¨ã§ã®ã¿ä½¿ç”¨ï¼‰
- é©åˆ‡ãªæŠ½è±¡åŒ–ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ä¿æŒã—ãŸã¾ã¾åˆ†å‰²å¯èƒ½

#### âš ï¸ **é‡è¦ãªç™ºè¦‹: é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨**

**é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰ã®è©³ç´°èª¿æŸ»:**
- `createFile()` ã¨ `createFileAsync()` - å®Ÿè£…ãŒã»ã¼åŒã˜ï¼ˆå¤‰æ•°ä»£å…¥ã®å¾®ç´°ãªé•ã„ã®ã¿ï¼‰
- `deleteFile()` ã¨ `deleteFileAsync()` - å®Ÿè£…ãŒã»ã¼åŒã˜ï¼ˆå¤‰æ•°ä»£å…¥ã®å¾®ç´°ãªé•ã„ã®ã¿ï¼‰
- `renameFile()` ã¨ `renameFileAsync()` - å®Ÿè£…ãŒå®Œå…¨ã«åŒã˜ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã®é•ã„ã®ã¿ï¼‰
- `deleteDirectory()` ã¨ `deleteDirectoryAsync()` - **å®Ÿè£…ãŒå®Œå…¨ã«åŒã˜**ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰åã®é•ã„ã®ã¿ï¼‰

**çµ±åˆæ–¹é‡:**
- Asyncç‰ˆãƒ¡ã‚½ãƒƒãƒ‰ã«çµ±åˆï¼ˆã‚ˆã‚Šæ–°ã—ã„å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
- ãƒ¡ã‚½ãƒƒãƒ‰æ•°ã‚’30å€‹ â†’ **23å€‹ã«å‰Šæ¸›å¯èƒ½**ï¼ˆã•ã‚‰ã«1ã¤å‰Šæ¸›ï¼‰
- è¨­è¨ˆã®å˜ç´”åŒ–ã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§å‘ä¸Š
- `moveFileAsync()` ã¨ `moveDirectoryAsync()` ã¯æ—¢ã«Asyncç‰ˆã®ã¿

#### åˆ†å‰²æ–¹é‡ã®æ±ºå®š

**æ¥­å‹™ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ™ãƒ¼ã‚¹ã®åˆ†å‰²** ã‚’æ¡ç”¨ï¼š
- æ“ä½œã®ç¨®é¡ï¼ˆãƒ•ã‚¡ã‚¤ãƒ« vs ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ã§ã¯ãªã
- æ¥­å‹™ã®è²¬å‹™ï¼ˆåŸºæœ¬ç®¡ç† vs å°‚é–€æ©Ÿèƒ½ï¼‰ã§åˆ†å‰²ã™ã‚‹
- **ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯æ¡ç”¨ã—ãªã„**ï¼ˆä¸€æ‹¬æ›´æ–°ã®ãŸã‚å¾Œæ–¹äº’æ›æ€§ä¸è¦ï¼‰

**ä¿®æ­£ã•ã‚ŒãŸæœ€çµ‚è¨­è¨ˆï¼ˆ23ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰:**

```
ç¾åœ¨: FileOperationService (1714è¡Œ, 30ãƒ¡ã‚½ãƒƒãƒ‰)
                    â†“
åˆ†å‰²å¾Œ: 3ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ï¼ˆé‡è¤‡å‰Šé™¤+çµ±åˆï¼‰

1ï¸âƒ£ CoreFileService (~600è¡Œ)
   ğŸ“ åŸºæœ¬ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ“ä½œ [8ãƒ¡ã‚½ãƒƒãƒ‰]
   - createFile(), deleteFile(), renameFile()  
   - moveFile(), moveDirectory()
   - deleteDirectory()
   - reorderFiles()
   - readFile(), writeFile(), exists() (ä½ãƒ¬ãƒ™ãƒ«API)

2ï¸âƒ£ MetadataService (~400è¡Œ)  
   ğŸ“‹ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å°‚ç”¨æ“ä½œ [8ãƒ¡ã‚½ãƒƒãƒ‰]
   - ã‚¿ã‚°æ“ä½œ: addTag(), removeTag(), setTags()
   - å‚ç…§æ“ä½œ: addReference(), removeReference(), setReferences()
   - updateMetaYaml(), updateAllReferences()

3ï¸âƒ£ FileManagementService (~500è¡Œ) â† åå‰ç¶™ç¶š
   ğŸ­ ç‰¹æ®Šæ“ä½œãƒ»æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ [7ãƒ¡ã‚½ãƒƒãƒ‰]
   - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼: setCharacterImportance(), setMultipleCharacters(), removeCharacter()
   - ä¼ç·š: setForeshadowing(), removeForeshadowing()
   - ç‰¹æ®Šç®¡ç†: addFileToManagement(), createMissingFile()
   
   â€» removeFileFromManagement()ã¯æ—¢å­˜FileManagementServiceã‹ã‚‰ç¶™æ‰¿
```

**çµ±åˆãƒ»æ”¹å–„ã•ã‚Œã‚‹é …ç›®:**
- **é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤ [4å€‹]**: `createFile()`, `deleteFile()`, `renameFile()`, `deleteDirectory()` â†’ Asyncç‰ˆã«çµ±åˆ
- **ãƒ¡ã‚½ãƒƒãƒ‰åç°¡ç•¥åŒ–**: å…¨ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰ä¸è¦ãª`Async`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤
  - ä¾‹: `createFileAsync()` â†’ `createFile()` (æˆ»ã‚Šå€¤å‹`Promise<T>`ã§éåŒæœŸã¯æ˜ç¢º)
- **æ—¢å­˜é‡è¤‡å‰Šé™¤**: `removeFileFromManagement()` (æ—¢å­˜FileManagementServiceã«æ—¢å­˜)
- **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰**: æ•´ç†çµ±åˆ

### ä¿®æ­£ã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ©ç‚¹

#### ğŸ›¡ï¸ ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ä¿æŒ
- **è¤‡åˆæ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¶­æŒ**: ãƒ•ã‚¡ã‚¤ãƒ«+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã¯æ–°ã‚µãƒ¼ãƒ“ã‚¹å†…ã§ã‚‚ç¶™ç¶š
- **ä½ãƒ¬ãƒ™ãƒ«APIéš è”½**: FileRepositoryç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã‚’å„ã‚µãƒ¼ãƒ“ã‚¹å†…ã«å°ã˜è¾¼ã‚
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¢ƒç•Œ**: ã‚µãƒ¼ãƒ“ã‚¹å˜ä½ã§ã®å¤±æ•—æ™‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯¾å¿œ

#### ğŸ“¦ è²¬å‹™ã®æ˜ç¢ºåŒ–  
- **CoreFileService**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ + å¿…è¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°
- **MetadataService**: meta.yamlå°‚ç”¨æ“ä½œï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ å¤‰æ›´ãªã—ï¼‰
- **FileManagementService**: ç‰¹æ®Šæ“ä½œãƒ»æ¥­å‹™ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰å‡¦ç†

#### ğŸ¯ ç°¡æ½”ãªè¨­è¨ˆ
- **é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰å‰Šé™¤**: 30ãƒ¡ã‚½ãƒƒãƒ‰ â†’ **23ãƒ¡ã‚½ãƒƒãƒ‰ã«å‰Šæ¸›**
- **ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ä¸è¦**: ä¸€æ‹¬æ›´æ–°ã«ã‚ˆã‚Šå¾Œæ–¹äº’æ›æ€§ç¶­æŒã®è¤‡é›‘æ€§ã‚’æ’é™¤
- **å‘½åã®ç°¡æ½”æ€§**: ä¸è¦ãª`Async`ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤ï¼ˆTypeScriptã®å‹ã§æ˜ç¢ºï¼‰

#### ğŸ”„ ç§»è¡Œæˆ¦ç•¥
- **ä¸€æ‹¬æ›´æ–°**: å…¨åˆ©ç”¨ç®‡æ‰€ã‚’ä¸€åº¦ã«æ›´æ–°ï¼ˆ12+ç®‡æ‰€ï¼‰
- **ãƒ†ã‚¹ãƒˆæ›´æ–°**: æ—¢å­˜ãƒ†ã‚¹ãƒˆã‚’ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ã«åˆ†å‰²ãƒ»æ•´ç†
- **æ®µéšçš„å®Ÿè£…**: MetadataService â†’ FileManagementService â†’ CoreFileService ã®é †

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼ã®ä»•çµ„ã¿

#### è¨­è¨ˆåŸå‰‡
1. **è¤‡åˆæ“ä½œã®ä¸å¯åˆ†æ€§**: ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¯å¸¸ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã¨ã‚»ãƒƒãƒˆå®Ÿè¡Œ
2. **ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ†é›¢**: æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¨ä½ãƒ¬ãƒ™ãƒ«æ“ä½œã®æ˜ç¢ºãªå¢ƒç•Œ
3. **å¤±æ•—å®‰å…¨**: ä¸€éƒ¨æ“ä½œå¤±æ•—æ™‚ã®é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

#### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
// âŒ åˆ†é›¢å‰ï¼ˆãƒªã‚¹ã‚¯ã‚ã‚Šï¼‰
await fileService.createPhysicalFile(path, content);
await metadataService.addFileEntry(path, metadata); // å¿˜ã‚Œã‚‹å¯èƒ½æ€§

// âœ… åˆ†é›¢å¾Œï¼ˆå®‰å…¨ï¼‰
await coreFileService.createFileAsync(dirPath, fileName, fileType, content); 
// â†‘ å†…éƒ¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚’ä¸å¯åˆ†å®Ÿè¡Œ
```

## ä¿®æ­£ã•ã‚ŒãŸå®Ÿè£…è¨ˆç”» ğŸš€

### Phase 1: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ âœ… **å®Œäº†**
- [x] **MetadataService**ã®å®Ÿè£… (8ãƒ¡ã‚½ãƒƒãƒ‰ç§»è¡Œ)
  - ã‚¿ã‚°ãƒ»å‚ç…§æ“ä½œã®å˜ç´”ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å°‚ç”¨æ“ä½œ
  - æœ€ã‚‚ãƒªã‚¹ã‚¯ãŒä½ãã€ç‹¬ç«‹æ€§ãŒé«˜ã„
- [x] MetadataServiceã®å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (12ãƒ†ã‚¹ãƒˆ)
- [x] ServiceContaineræ›´æ–° (MetadataService DIè¨­å®š)

### Phase 2: ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹æ‹¡å¼µ âœ… **å®Œäº†**
- [x] **FileManagementService**ã®æ‹¡å¼µå®Ÿè£… (7ãƒ¡ã‚½ãƒƒãƒ‰ç§»è¡Œ)
  - æ—¢å­˜3ãƒ¡ã‚½ãƒƒãƒ‰ + ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»ä¼ç·šæ©Ÿèƒ½4ãƒ¡ã‚½ãƒƒãƒ‰è¿½åŠ 
  - æ—§FileManagementServiceã¨ã®çµ±åˆ
- [x] æ‹¡å¼µFileManagementServiceã®å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (15ãƒ†ã‚¹ãƒˆ)

### Phase 3: ã‚³ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ âœ… **å®Œäº†**
- [x] **CoreFileService**ã®å®Ÿè£… (8ãƒ¡ã‚½ãƒƒãƒ‰ç§»è¡Œ)
  - æœ€ã‚‚è¤‡é›‘ãªãƒ•ã‚¡ã‚¤ãƒ«+ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿è¤‡åˆæ“ä½œ
  - é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰çµ±åˆï¼ˆAsyncç‰ˆã«ä¸€æœ¬åŒ–ï¼‰
  - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®é‡ç‚¹ãƒ†ã‚¹ãƒˆ
  - ä½ãƒ¬ãƒ™ãƒ«APIãƒ¡ã‚½ãƒƒãƒ‰ã«ç‰¹æ®Šç”¨é€”ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 
- [x] CoreFileServiceã®å˜ä½“ãƒ†ã‚¹ãƒˆä½œæˆ (21ãƒ†ã‚¹ãƒˆ)

### Phase 4: çµ±åˆã¨ä¸€æ‹¬æ›´æ–° âœ… **å®Œäº†** 
- [x] ServiceContainerå®Œå…¨æ›´æ–°ï¼ˆå…¨DIãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å¤‰æ›´ï¼‰
- [x] åˆ©ç”¨ç®‡æ‰€ä¸€æ‹¬æ›´æ–°ï¼ˆ12+ç®‡æ‰€ã®importãƒ»ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—å¤‰æ›´ï¼‰
- [x] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ»CIç¢ºèªï¼ˆnpm run check-all æˆåŠŸï¼‰

**ä¸»è¦ãªæ›´æ–°å®Œäº†:**
- DialogoiTreeDataProvider.ts: å…¨ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ–°ã‚µãƒ¼ãƒ“ã‚¹ã«ç½®ãæ›ãˆ
- FileDetailsViewProvider.ts: renameFile â†’ CoreFileService 
- characterCommands.ts: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ“ä½œ â†’ FileManagementService
- FilePathMapService.ts: CoreFileServiceä¾å­˜ã«å¤‰æ›´
- å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: æ–°ã‚µãƒ¼ãƒ“ã‚¹å¯¾å¿œæ¸ˆã¿

### Phase 5: æœ€çµ‚æ•´ç† ğŸ”„ **é€²è¡Œä¸­**
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆã®åˆ†å‰²ãƒ»æ•´ç†ï¼ˆã‚µãƒ¼ãƒ“ã‚¹åˆ¥ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆä½œæˆï¼‰
- [ ] æ—§FileOperationServiceå‰Šé™¤ï¼ˆä¾å­˜é–¢ä¿‚ã®æœ€çµ‚èª¿æ•´ï¼‰

## æ³¨æ„äº‹é …ãƒ»ãƒªã‚¹ã‚¯

### ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒªã‚¹ã‚¯
- ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã®åˆ†é›¢ã«ã‚ˆã‚‹ä¸æ•´åˆ
- è¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹é–“ã§ã®æ“ä½œé †åºã®é‡è¦æ€§
- ã‚¨ãƒ©ãƒ¼å‡¦ç†æ™‚ã®éƒ¨åˆ†çš„ãªçŠ¶æ…‹å¤‰æ›´

### ç§»è¡Œãƒªã‚¹ã‚¯
- 12+ç®‡æ‰€ã®åˆ©ç”¨ç®‡æ‰€ã§ã®ç ´å£Šçš„å¤‰æ›´
- ãƒ†ã‚¹ãƒˆã®å¤§å¹…ãªæ›¸ãæ›ãˆ
- è¤‡é›‘ãªä¾å­˜é–¢ä¿‚ã«ã‚ˆã‚‹äºˆæœŸã—ãªã„å‰¯ä½œç”¨

## é€²æ—è¨˜éŒ²

### 2025-01-28 (åˆå›èª¿æŸ»)
- [x] èª¿æŸ»è¨ˆç”»æ›¸ä½œæˆ
- [x] FileOperationServiceãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ä½œæˆï¼ˆ30ãƒ¡ã‚½ãƒƒãƒ‰ç‰¹å®šï¼‰
- [x] åˆ©ç”¨ç®‡æ‰€ã®è©³ç´°èª¿æŸ»ï¼ˆ4ç®‡æ‰€ã®ä¸»è¦åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æï¼‰
- [x] ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ“ä½œã®å¿…è¦æ€§ç¢ºèªï¼ˆ3ã¤ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ç‰¹å®šï¼‰
- [x] FileManagementServiceã¨ã®æ©Ÿèƒ½é‡è¤‡åˆ†æï¼ˆçµ±åˆæ–¹é‡æ±ºå®šï¼‰
- [x] **åˆ†å‰²æˆ¦ç•¥ã®ç¢ºå®š** - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒªã‚¹ã‚¯ã¯ä½ã„ã“ã¨ã‚’ç¢ºèª
- [x] **æœ€çµ‚åˆ†å‰²è¨­è¨ˆæ¡ˆã®ç­–å®š** - 3+1ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2025-01-28 (è¨­è¨ˆä¿®æ­£)
- [x] **é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰èª¿æŸ»ãƒ»çµ±åˆæ–¹é‡ç¢ºå®š** - 30 â†’ 23ãƒ¡ã‚½ãƒƒãƒ‰ã«å‰Šæ¸›
- [x] **ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³å‰Šé™¤** - å¾Œæ–¹äº’æ›æ€§ä¸è¦ã®ãŸã‚è¨­è¨ˆç°¡ç•¥åŒ–
- [x] **BusinessLogicService â†’ FileManagementServiceåå‰ä¿®æ­£**
- [x] **å®Ÿè£…è¨ˆç”»ã®å†ç­–å®š** - 4ãƒ•ã‚§ãƒ¼ã‚ºã«ã‚ˆã‚‹æ®µéšçš„å®Ÿè£…
- [x] **è¿½åŠ é‡è¤‡èª¿æŸ»** - deleteDirectory/deleteDirectoryAsyncçµ±åˆç¢ºèª
- [x] **ãƒ¡ã‚½ãƒƒãƒ‰å‘½åæ”¹å–„** - ä¸è¦ãªAsyncã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹å‰Šé™¤æ–¹é‡æ±ºå®š

## èª¿æŸ»ãƒ»è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚ºå®Œäº† âœ…

**é‡è¦ãªæˆæœ:**
1. **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®æ‡¸å¿µã¯ææ†‚** - ç¾åœ¨ã®è¨­è¨ˆã§æ—¢ã«é©åˆ‡ã«ç®¡ç†
2. **é‡è¤‡ãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª** - createFile/createFileAsyncç­‰ã®ä¸è¦ãªé‡è¤‡ã‚’ç‰¹å®š
3. **è¨­è¨ˆã®ç°¡ç•¥åŒ–** - ãƒ•ã‚¡ã‚µãƒ¼ãƒ‰ä¸è¦ã€ä¸€æ‹¬æ›´æ–°ã«ã‚ˆã‚‹ç›´æ¥çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
4. **å‘½åã®ä¸€è²«æ€§** - FileManagementServiceåã®ç¶™ç¶šã€Asyncç‰ˆã¸ã®çµ±ä¸€

### 2025-01-28 (Phase 1 & 2 å®Ÿè£…å®Œäº†) âœ…

**Phase 1å®Ÿè£…æˆæœ:**
- [x] **MetadataService**å®Œå…¨å®Ÿè£…ï¼ˆ8ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
  - ã‚¿ã‚°æ“ä½œ: `addTag()`, `removeTag()`, `setTags()`
  - å‚ç…§æ“ä½œ: `addReference()`, `removeReference()`, `setReferences()`
  - æ±ç”¨æ“ä½œ: `updateMetaYaml()`, `updateAllReferences()`
- [x] MetadataService.test.tsä½œæˆï¼ˆ12ãƒ†ã‚¹ãƒˆï¼‰
- [x] ServiceContainer/TestServiceContainer DIè¨­å®šæ›´æ–°

**Phase 2å®Ÿè£…æˆæœ:**
- [x] **FileManagementService**æ‹¡å¼µå®Ÿè£…ï¼ˆ7ãƒ¡ã‚½ãƒƒãƒ‰ç§»è¡Œï¼‰
  - æ—¢å­˜æ©Ÿèƒ½3ãƒ¡ã‚½ãƒƒãƒ‰: `addFileToManagement()`, `removeFileFromManagement()`, `createMissingFile()`
  - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ©Ÿèƒ½3ãƒ¡ã‚½ãƒƒãƒ‰: `setCharacterImportance()`, `setMultipleCharacters()`, `removeCharacter()`
  - ä¼ç·šæ©Ÿèƒ½2ãƒ¡ã‚½ãƒƒãƒ‰: `setForeshadowing()`, `removeForeshadowing()`
  - ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæ±ç”¨ãƒ¡ã‚½ãƒƒãƒ‰: `updateMetaYaml()`
- [x] FileManagementService.test.tsä½œæˆï¼ˆ15ãƒ†ã‚¹ãƒˆï¼‰
- [x] ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ä¿®æ­£ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ æº–æ‹ ï¼‰

**å“è³ªæŒ‡æ¨™:**
- **å…¨475ãƒ†ã‚¹ãƒˆé€šé** âœ…
- TypeScript/ESLint/Prettierå…¨é€šé âœ…
- check-all CIé€šé âœ…
- git commitå®Œäº† âœ…

### 2025-01-28 (Phase 4å®Œäº†ãƒ»Phase 5é–‹å§‹) âœ…

**Phase 4å®Ÿè£…æˆæœ:**
- [x] **ServiceContainerå®Œå…¨æ›´æ–°** - DIè¨­å®šã‚’å…¨ã¦æ–°ã‚µãƒ¼ãƒ“ã‚¹ã«å¯¾å¿œ
- [x] **ä¸»è¦åˆ©ç”¨ç®‡æ‰€ã®ä¸€æ‹¬æ›´æ–°å®Œäº†:**
  - DialogoiTreeDataProvider.ts: å…¨10ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é©åˆ‡ãªã‚µãƒ¼ãƒ“ã‚¹ï¼ˆCoreFileService/MetadataServiceï¼‰ã«åˆ†å‰²
  - FileDetailsViewProvider.ts: renameFileæ“ä½œã‚’CoreFileServiceã«ç§»è¡Œ
  - characterCommands.ts: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ“ä½œã‚’FileManagementServiceã«ç§»è¡Œ
  - FilePathMapService.ts: getNovelRootPath()ã‚’CoreFileServiceã‹ã‚‰å–å¾—
- [x] **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°:** FilePathMapService.test.ts, HyperlinkExtractorService.test.tsã®æ–°ã‚µãƒ¼ãƒ“ã‚¹å¯¾å¿œ
- [x] **çµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸ:** npm run check-all å®Œå…¨é€šéï¼ˆ475ãƒ†ã‚¹ãƒˆæˆåŠŸï¼‰

**Phase 5é–‹å§‹:**
- MetadataServiceã®FileOperationServiceä¾å­˜é–¢ä¿‚ã®æ•´ç†ãŒæ®‹å­˜
- æ—§FileOperationServiceã®å‰Šé™¤æº–å‚™

**å“è³ªæŒ‡æ¨™ï¼ˆPhase 4å®Œäº†æ™‚ç‚¹ï¼‰:**
- **å…¨475ãƒ†ã‚¹ãƒˆé€šé** âœ…
- TypeScript/ESLint/Prettierå…¨é€šé âœ…
- CI check-all å®Œå…¨æˆåŠŸ âœ…
- ç ´å£Šçš„å¤‰æ›´ãªã—ï¼ˆæ—¢å­˜APIç¶™ç¶šå‹•ä½œï¼‰ âœ…

## æ¬¡å›ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§ã®ç¶™ç¶šãƒã‚¤ãƒ³ãƒˆ

**Phase 5: æœ€çµ‚æ•´ç†**ã‹ã‚‰é–‹å§‹ï¼š
1. **MetadataServiceä¾å­˜é–¢ä¿‚æ•´ç†** - FileOperationServiceä¾å­˜ã®è§£æ¶ˆ
2. **æ—§FileOperationServiceå‰Šé™¤** - å®Œå…¨ãªç§»è¡Œå®Œäº†
3. **ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ•´ç†** - ã‚µãƒ¼ãƒ“ã‚¹åˆ¥ãƒ†ã‚¹ãƒˆæ§‹é€ ã®æœ€é©åŒ–ï¼ˆä»»æ„ï¼‰