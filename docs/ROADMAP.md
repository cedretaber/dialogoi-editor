# Dialogoi Editor ロードマップ

## 開発フェーズ

### 🚀 Phase 1: MVP (Minimum Viable Product) ✅ **完了**
**目標**: 基本的なファイル管理機能を持つExtensionの実装

- [x] VSCode Extension の基本構造構築
- [x] TreeView による小説構造の表示
- [x] `meta.yaml` の読み書き機能
- [x] ファイルの作成・削除・並び替え
- [x] 基本的なアイコン表示（本文/設定の区別）

**追加実装された機能**:
- [x] ディレクトリクリックでREADME.md表示
- [x] ファイル名変更機能
- [x] 自動拡張子付与（.txt/.md）
- [x] 選択中のディレクトリでのファイル作成
- [x] 包括的なテストスイート
- [x] サンプル小説プロジェクト

### 📝 Phase 2: メタデータ管理強化 ✅ **完了**
**目標**: 小説執筆に必要なメタデータ管理機能の充実

- [x] タグシステムの実装
- [x] 参照関係（references）の管理
- [x] ファイルハッシュによる変更検知システム
- [x] レビュー機能の基本実装
- [x] キャラクター設定の専用UI（メタデータ拡張・表示名自動取得）
- [x] 用語集の専用UI（基本機能 - glossary: true識別のみ）
- [x] 伏線管理機能（start/goal）
- [x] `dialogoi.yaml` の仕様策定と実装
- [x] 小説プロジェクト新規作成機能

**Phase 2a 完了済み機能**:
- [x] ファイル・ディレクトリへのタグ付与
- [x] コンテキストメニューからのタグ編集
- [x] TreeViewでのタグ表示（#タグ形式）
- [x] 参照関係の双方向管理（Mapベース）
- [x] ツールチップでの参照関係表示
- [x] 存在しないファイルへの参照検出
- [x] 包括的なテストスイート（タグ・参照機能）

**Phase 2b 完了済み機能**:
- [x] SHA-256ハッシュによるファイル変更検知システム
- [x] レビュー機能の実装（basic）
  - [x] レビュー追加・編集・削除
  - [x] レビューファイル（_reviews.yaml）の管理
  - [x] レビューステータス管理（open/in_progress/resolved/dismissed）
  - [x] スレッド形式での議論機能
  - [x] VSCode UI統合（コンテキストメニュー）
  - [x] 包括的なテストスイート（レビュー機能）

**Phase 2c 完了済み機能**:
- [x] `dialogoi.yaml` 仕様策定と実装
  - [x] プロジェクトメタデータ（title, author, version, created_at, tags）
  - [x] プロジェクト設定（readme_filename, exclude_patterns）
  - [x] DialogoiYamlUtils/DialogoiYamlService実装
  - [x] バリデーション機能とエラーハンドリング
- [x] 小説プロジェクト新規作成機能
  - [x] 既存ディレクトリの再帰的スキャン
  - [x] 自動meta.yaml生成（ファイル種別自動判定）
  - [x] 既存meta.yaml尊重機能
  - [x] 除外パターンによるファイルフィルタリング
  - [x] プロジェクトテンプレート機能
  - [x] 包括的なテストスイート（106テスト）

### 🔧 Phase 2.5: アーキテクチャリファクタリング ✅ **完了**
**目標**: Repository/Service層の設計問題を解決し、適切な責務分離を実装

**問題の分析**:
- Repository が複雑すぎる（meta.yaml更新など高レベル操作を担当）
- Service層への循環依存が発生
- テスト可能性の低下

**実装完了**:
- [x] Repository/Service設計の問題分析
- [x] MetaYamlService の作成（依存関係注入パターン）
- [x] FileOperationService の新規実装
- [x] Repository から高レベルメソッドを削除
- [x] ServiceContainer への新サービス追加
- [x] MetaYamlUtils の純粋化（YAML処理のみ）
- [x] 全ファイルでの Repository → Service 呼び出し更新
- [x] 単体テストの修正
- [x] エラー解消

**結果**:
- ✅ 全 106 テストが成功
- ✅ TypeScript コンパイルエラー 0 個
- ✅ ESLint エラー 0 個
- ✅ 適切な責務分離により保守性が向上
- ✅ テスト環境での依存関係注入が正しく動作
- ✅ IServiceContainer インターフェースによる柔軟な実装

**設計改善**:
- **Repository**: 純粋なデータアクセス層（ファイル読み書きのみ）
- **Service**: ビジネスロジック（複雑な操作・バリデーション）
- **適切な依存関係**: Service → Repository（循環依存なし）

### 🛠️ Phase 2.8: コードベースリファクタリング 🗓️ **進行中**
**目標**: Phase 3 進出前の大規模リファクタリングでコード品質を最大化

**コードベース分析結果**:
- ✅ 未使用コードの特定完了
- ✅ TypeScript ベストプラクティス違反の特定完了
- ✅ アーキテクチャ上の問題の特定完了
- ✅ リファクタリング計画の作成完了
- ✅ ESLint設定の修正完了（120個の問題検出: 113エラー、7警告）

**リファクタリング計画**:

#### 🔥 **Phase 2.8a: 緊急性の高い問題の解決** 🔴 **高優先度**
- [x] **ESLint設定の修正** - lintコマンドが適切にエラーを検出するように修正
  - package.jsonのlintコマンドに`--max-warnings 0`を追加
  - glob パターンをクォートで囲むように修正
- [x] **any型の排除** - extension.tsで`item: any`を適切な型に置き換え
  - `DialogoiTreeItem`型を使用した型安全なコマンドハンドラーの実装
  - 全ての any 型を排除（requireもimportに変更）
- [x] **デバッグ出力の削除** - DialogoiTreeDataProvider.tsの大量のconsole.warnを削除
  - 19個のデバッグ用console.warnを全て削除
- [x] **本番環境での不要な出力削除** - extension.tsのconsole.logを削除
  - console.logをconsole.warnに変更（Logger実装までの暫定対応）
  - Logger 実装後に置き換え予定

#### 🟠 **Phase 2.8b: アーキテクチャの改善** 🔶 **中優先度**
- [ ] **extension.tsの分割** - 700行の巨大ファイルを機能別に分割
  - ファイルコマンドハンドラーの分離
  - タグコマンドハンドラーの分離
  - 参照コマンドハンドラーの分離
- [ ] **複雑なメソッドの簡素化** - 長いメソッドを小さな関数に分割
  - `ProjectCreationService.ts`の長いメソッドを分割
  - `DialogoiTreeDataProvider.ts`の`setTooltip()`メソッドを簡素化
- [ ] **エラーハンドリングの統一** - 一貫したエラーハンドリングパターンの採用
  - Logger クラスの実装
  - エラーメッセージの形式統一
  - エラーログの処理統一

#### 🟡 **Phase 2.8c: コードクリーンアップ** 🔸 **低優先度**
- [ ] **未使用コードの削除** - 使用されていないメソッドや変数の削除
  - `ReferenceManager.ts`の`debugPrintReferences()`メソッド削除
  - `Uri.ts`の`UriFactory`クラスの使用状況確認と整理
- [ ] **重複コードの削除** - 共通処理の関数化
  - レビューコマンドでの重複したワークスペース取得処理を統一
- [ ] **細かい改善** - 命名規則やコメントの整理
  - 一貫性のない命名の修正
  - 不要なコメントの削除

**成果目標**:
- ✅ TypeScript 型安全性の完全確保（any型の排除）
- ✅ 本番環境でのクリーンなコンソール出力
- ✅ 保守性の高いモジュール構成（extension.tsの分割）
- ✅ 一貫したエラーハンドリング
- ✅ デッドコードの除去とコード品質の向上
- ✅ 172個のテストが全て成功を維持

**進行状況**:
- ✅ コードベース分析完了
- ✅ リファクタリング計画作成完了
- ✅ Phase 2.8a 緊急性の高い問題の解決完了
  - ESLintエラー: 120個 → 19個に削減（84%削減）
  - 警告: 7個 → 0個（100%削減）
- ⏳ Phase 2.8b アーキテクチャの改善開始準備

### 🎨 Phase 3: UI/UX改善
**目標**: より使いやすいインターフェースの提供

- [ ] WebView による詳細設定画面
- [ ] ドラッグ&ドロップでの並び替え改善
- [ ] 検索・フィルタリング機能
- [ ] ハイパーリンク機能
- [ ] コンテキストメニューの充実
- [ ] キーボードショートカットの実装
- [ ] 多言語対応（日本語優先）

### 🔍 Phase 4: 高度な分析機能
**目標**: 執筆支援のための分析・可視化機能

- [ ] 伏線の可視化（タイムライン表示）
- [ ] キャラクター相関図
- [ ] 話数ごとの登場人物追跡
- [ ] 参照関係のグラフ表示
- [ ] 執筆統計（文字数、更新頻度等）

## 将来的な機能拡張

### 📖 執筆支援機能

1. **プレビュー機能**
   - 青空文庫形式の解釈
   - 縦書き表示対応
   - リアルタイムプレビュー

2. **PDF出力機能**
   - 印刷用レイアウト
   - 電子書籍形式への変換
   - カスタムスタイルシート対応

3. **タイムライン機能**
   - 作品内時系列の可視化
   - 矛盾検出機能
   - 読者視点での伏線タイムライン

4. **バージョン管理連携**
   - Git統合の強化
   - 変更履歴の可視化
   - 共同執筆サポート

### 🤖 AI連携機能

1. **Dialogoi MCP サーバ連携**
   - キャラクター設定に基づく対話生成
   - 設定の一貫性チェック
   - プロット提案機能

2. **執筆アシスタント**
   - 文章校正機能
   - 類語・表現提案
   - スタイル統一チェック

### 📊 分析・管理機能

1. **プロジェクト管理**
   - 執筆スケジュール管理
   - 進捗トラッキング
   - 目標設定機能

2. **テンプレート機能**
   - プロジェクトテンプレート
   - キャラクターシートテンプレート
   - ジャンル別構成テンプレート

3. **エクスポート/インポート**
   - 他の執筆ツールとの連携
   - バックアップ機能
   - クラウド同期

### 🤝 コラボレーション機能

1. **レビュー管理システム** *(Phase 2b で基本機能実装済み)*
   - [x] 編集者からのフィードバック管理
   - [x] レビューの位置追跡とハッシュによる変更検知
   - [x] スレッド形式での議論機能
   - [x] ステータス管理（open/in_progress/resolved/dismissed）
   - [ ] AIレビューの統合（Dialogoi MCP連携）

2. **共同執筆サポート**
   - 複数人での同時編集対応
   - 変更履歴の可視化
   - コンフリクト解決支援

## 技術的改善

### パフォーマンス最適化
- 大規模プロジェクト対応（1000話以上）
- インクリメンタル更新
- 遅延読み込み

### 品質向上
- 自動テストの充実
- エラーハンドリング改善
- ユーザビリティテスト

### 拡張性
- プラグインシステム
- カスタムメタデータ対応
- API公開

## コミュニティ機能（長期構想）

- 作品共有プラットフォーム
- 執筆テクニック共有
- ユーザーフォーラム
- 公式テンプレート配布

---

**注**: このロードマップは現時点での構想であり、ユーザーフィードバックや技術的制約により変更される可能性があります。